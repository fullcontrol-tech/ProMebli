document.addEventListener('DOMContentLoaded', function () {
    // ÐœÐ¾Ð±Ñ–Ð»ÑŒÐ½Ðµ Ð¼ÐµÐ½ÑŽ
    const navMenu = document.getElementById('nav-menu');
    const navToggle = document.getElementById('nav-toggle');
    const navClose = document.getElementById('nav-close');
    
    // Ð’Ñ–Ð´ÐºÑ€Ð¸Ñ‚Ñ‚Ñ Ð¼ÐµÐ½ÑŽ
    if (navToggle) {
        navToggle.addEventListener('click', () => {
            navMenu.classList.add('active');
            navToggle.classList.add('hidden'); // ÐŸÑ€Ð¸Ñ…Ð¾Ð²ÑƒÑ”Ð¼Ð¾ Ð±ÑƒÑ€Ð³ÐµÑ€
            document.body.style.overflow = 'hidden'; // Ð‘Ð»Ð¾ÐºÑƒÑ”Ð¼Ð¾ ÑÐºÑ€Ð¾Ð»
        });
    }
    
    // Ð¤ÑƒÐ½ÐºÑ†Ñ–Ñ Ð·Ð°ÐºÑ€Ð¸Ñ‚Ñ‚Ñ Ð¼ÐµÐ½ÑŽ
    function closeMenu() {
        navMenu.classList.remove('active');
        navToggle.classList.remove('hidden'); // ÐŸÐ¾Ð²ÐµÑ€Ñ‚Ð°Ñ”Ð¼Ð¾ Ð±ÑƒÑ€Ð³ÐµÑ€
        document.body.style.overflow = ''; // ÐŸÐ¾Ð²ÐµÑ€Ñ‚Ð°Ñ”Ð¼Ð¾ ÑÐºÑ€Ð¾Ð»
    }
    
    // Ð—Ð°ÐºÑ€Ð¸Ñ‚Ñ‚Ñ Ð¼ÐµÐ½ÑŽ Ñ‡ÐµÑ€ÐµÐ· ÐºÐ½Ð¾Ð¿ÐºÑƒ Ð·Ð°ÐºÑ€Ð¸Ñ‚Ñ‚Ñ
    if (navClose) {
        navClose.addEventListener('click', closeMenu);
    }
    
    // Ð—Ð°ÐºÑ€Ð¸Ñ‚Ñ‚Ñ Ð¼ÐµÐ½ÑŽ Ð¿Ñ€Ð¸ ÐºÐ»Ñ–ÐºÑƒ Ð½Ð° ÑÑÐ¸Ð»ÐºÐ¸
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', closeMenu);
    });
    
    // Ð—Ð°ÐºÑ€Ð¸Ñ‚Ñ‚Ñ Ð¼ÐµÐ½ÑŽ Ð¿Ñ€Ð¸ ÐºÐ»Ñ–ÐºÑƒ Ð¿Ð¾Ð·Ð° Ð¼ÐµÐ½ÑŽ
    document.addEventListener('click', (e) => {
        if (navMenu.classList.contains('active') && 
            !navMenu.contains(e.target) && 
            !navToggle.contains(e.target)) {
            closeMenu();
        }
    });

    // --- Ð¡Ð»Ð°Ð¹Ð´ÐµÑ€ Ð¿Ð¾Ñ€Ñ‚Ñ„Ð¾Ð»Ñ–Ð¾ ---
    const portfolioSlider = new Swiper('#portfolio-slider', {
        loop: true,
        slidesPerView: 1.2,
        spaceBetween: 20,
        centeredSlides: true,
        grabCursor: true,
        navigation: {
            nextEl: '#portfolio-slider .swiper-button-next',
            prevEl: '#portfolio-slider .swiper-button-prev',
        },
        pagination: {
            el: '.swiper-pagination',
            enabled: false,
        },
        breakpoints: {
            576: {
                slidesPerView: 2
            },
            768: {
                slidesPerView: 2.5,
                spaceBetween: 30,
                centeredSlides: false
            },
            1200: {
                slidesPerView: 3.5,
                spaceBetween: 40,
                centeredSlides: false
            }
        }
    });

    // --- Ð¡Ð»Ð°Ð¹Ð´ÐµÑ€ Ð²Ñ–Ð´Ð³ÑƒÐºÑ–Ð² ---
    const testimonialsSlider = new Swiper('#testimonials-slider', {
        slidesPerView: 1,
        spaceBetween: 30,
        loop: true,
        autoplay: {
            delay: 5000,
            disableOnInteraction: false,
        },
        navigation: {
            nextEl: '#testimonials-slider .swiper-button-next',
            prevEl: '#testimonials-slider .swiper-button-prev',
        },
        pagination: {
            el: '.swiper-pagination',
            enabled: false,
        },
        breakpoints: {
            768: {
                slidesPerView: 2,
            },
            1024: {
                slidesPerView: 3,
            },
        }
    });

    // --- ÐžÐ‘Ð ÐžÐ‘ÐÐ˜Ðš Ð¤ÐžÐ ÐœÐ˜ ---
    const leadForm = document.getElementById('leadForm');
    
    if (leadForm) {
        leadForm.addEventListener('submit', function (event) {
            // ÐÐµ Ð±Ð»Ð¾ÐºÑƒÑ”Ð¼Ð¾ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñƒ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²ÐºÑƒ â€” Ð¿Ð¾ÑˆÑ‚Ð° Ð¿Ñ–Ð´Ðµ Ñ‡ÐµÑ€ÐµÐ· FormSubmit
            sendTelegram();
            
            // Facebook Pixel Lead event
            if (typeof fbq === 'function') {
                fbq('track', 'Lead');
            }

            // Ð—Ð°Ð´Ð°Ñ”Ð¼Ð¾ Ð·Ð°Ñ‚Ñ€Ð¸Ð¼ÐºÑƒ Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÐ´Ñ–Ñ€ÐµÐºÑ‚Ð¾Ð¼, Ñ‰Ð¾Ð± Ñ„Ð¾Ñ€Ð¼Ð° Ð²ÑÑ‚Ð¸Ð³Ð»Ð° Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð¸Ñ‚Ð¸ÑÑŒ
            setTimeout(function() {
                window.location.href = 'thank-you.html';
            }, 500); // 0.5 ÑÐµÐºÑƒÐ½Ð´Ð¸
        });
    }

    function sendTelegram() {
        const name = document.querySelector('input[name="name"]').value.trim();
        const phone = document.querySelector('input[name="phone"]').value.trim();

        if (!name || !phone) return; // Ð‘ÐµÐ· Ð´Ð°Ð½Ð¸Ñ… Ð½Ðµ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ”Ð¼Ð¾

        const message = `ðŸ”¥ ÐÐ¾Ð²Ð° Ð·Ð°ÑÐ²ÐºÐ°!\nðŸ‘¤ Ð†Ð¼'Ñ: ${name}\nðŸ“ž Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: ${phone}`;

        const botToken = '7747442953:AAG_uTeisUybcX-mdhPJbvHSkj2sQi3M8JA';
        const chatId = '-1002821902695';

        const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                chat_id: chatId,
                text: message
            })
        }).then(response => {
            if (!response.ok) {
                console.error('Telegram API error:', response.statusText);
            }
        }).catch(error => {
            console.error('Telegram fetch error:', error);
        });
    }

    // --- FAQ Ñ€Ð¾Ð·ÐºÑ€Ð¸Ð²Ð½Ñ– ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¸ ---
    const faqQuestions = document.querySelectorAll('.faq-question');

    faqQuestions.forEach(question => {
        question.addEventListener('click', () => {
            const faqItem = question.parentElement;
            const answer = question.nextElementSibling;
            
            // Ð—Ð°ÐºÑ€Ð¸Ð²Ð°Ñ”Ð¼Ð¾ Ð²ÑÑ– Ñ–Ð½ÑˆÑ– Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–
            faqQuestions.forEach(q => {
                if (q !== question) {
                    q.classList.remove('active');
                    q.nextElementSibling.classList.remove('active');
                }
            });
            
            // ÐŸÐµÑ€ÐµÐ¼Ð¸ÐºÐ°Ñ”Ð¼Ð¾ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¸Ð¹ ÑÑ‚Ð°Ð½ Ð´Ð»Ñ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¾Ð³Ð¾ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ
            question.classList.toggle('active');
            answer.classList.toggle('active');
        });
    });

    // Ð›ÐžÐ“Ð†ÐšÐ Ð”Ð›Ð¯ ÐŸÐ ÐžÐ¡Ð¢ÐžÐ‡ Ð† Ð¡Ð¢ÐÐ‘Ð†Ð›Ð¬ÐÐžÐ‡ Ð“ÐÐ›Ð•Ð Ð•Ð‡
    const projectModal = document.getElementById('project-modal');
    const portfolioItems = document.querySelectorAll('.portfolio-item');
    
    if (projectModal && portfolioItems.length > 0) {
        const modalImage = document.getElementById('modal-image');
        const modalCounter = document.getElementById('modal-counter');
        const modalPrevBtn = document.getElementById('modal-prev');
        const modalNextBtn = document.getElementById('modal-next');

        let currentImages = [];
        let currentIndex = 0;

        // Ð¤ÑƒÐ½ÐºÑ†Ñ–Ñ Ð´Ð»Ñ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð²Ð¸Ð³Ð»ÑÐ´Ñƒ Ð³Ð°Ð»ÐµÑ€ÐµÑ—
        function updateModalView() {
            modalImage.classList.remove('active');
            
            // ÐŸÐ»Ð°Ð²Ð½Ð° Ð·Ð¼Ñ–Ð½Ð° Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð½Ñ
            setTimeout(() => {
                modalImage.src = currentImages[currentIndex];
                modalImage.onload = () => {
                    modalImage.classList.add('active');
                };
            }, 100);

            // ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð»Ñ–Ñ‡Ð¸Ð»ÑŒÐ½Ð¸ÐºÐ°
            modalCounter.textContent = `${currentIndex + 1} / ${currentImages.length}`;

            // ÐŸÑ€Ð¸Ñ…Ð¾Ð²ÑƒÐ²Ð°Ð½Ð½Ñ/Ð¿Ð¾ÐºÐ°Ð· ÐºÐ½Ð¾Ð¿Ð¾Ðº Ñ‚Ð° Ð»Ñ–Ñ‡Ð¸Ð»ÑŒÐ½Ð¸ÐºÐ°
            const showControls = currentImages.length > 1;
            modalPrevBtn.style.display = showControls ? 'block' : 'none';
            modalNextBtn.style.display = showControls ? 'block' : 'none';
            modalCounter.style.display = showControls ? 'block' : 'none';
        }

        // ÐÐ°Ð²Ñ–ÑˆÑƒÑ”Ð¼Ð¾ Ð¾Ð±Ñ€Ð¾Ð±Ð½Ð¸Ðº Ð½Ð° ÐºÐ¾Ð¶Ð½Ñƒ ÐºÐ°Ñ€Ñ‚ÐºÑƒ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ñƒ
        portfolioItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const data = e.currentTarget.dataset;
                
                // Ð—Ð±Ð¸Ñ€Ð°Ñ”Ð¼Ð¾ Ð´Ð°Ð½Ñ– Ð´Ð»Ñ Ð³Ð°Ð»ÐµÑ€ÐµÑ—
                currentImages = data.images ? data.images.split(',').map(url => url.trim()) : [item.querySelector('img').src];
                currentIndex = 0;

                // Ð—Ð°Ð¿Ð¾Ð²Ð½ÑŽÑ”Ð¼Ð¾ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ Ð¿Ñ€Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚
                document.getElementById('modal-title').textContent = data.title;
                document.getElementById('modal-date').textContent = data.date;
                document.getElementById('modal-description').textContent = data.description;
                
                // ÐžÐ½Ð¾Ð²Ð»ÑŽÑ”Ð¼Ð¾ Ð²Ð¸Ð³Ð»ÑÐ´ Ð³Ð°Ð»ÐµÑ€ÐµÑ— Ñ– Ð¿Ð¾ÐºÐ°Ð·ÑƒÑ”Ð¼Ð¾ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ðµ Ð²Ñ–ÐºÐ½Ð¾
                updateModalView();
                document.body.classList.add('modal-open');
                projectModal.classList.add('visible');
            });
        });

        // ÐÐ°Ð²Ñ–Ð³Ð°Ñ†Ñ–Ñ Ð² Ð³Ð°Ð»ÐµÑ€ÐµÑ—
        modalNextBtn.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % currentImages.length;
            updateModalView();
        });

        modalPrevBtn.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
            updateModalView();
        });

        // Ð—Ð°ÐºÑ€Ð¸Ñ‚Ñ‚Ñ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð²Ñ–ÐºÐ½Ð°
        const closeModal = () => {
            document.body.classList.remove('modal-open');
            projectModal.classList.remove('visible');
        };
        
        document.getElementById('modal-close').addEventListener('click', closeModal);
        
        projectModal.addEventListener('click', (e) => {
            if (e.target === projectModal) {
                closeModal();
            }
        });
        
        document.addEventListener('keydown', (e) => {
            if (e.key === "Escape") {
                closeModal();
            }
        });
    }
});